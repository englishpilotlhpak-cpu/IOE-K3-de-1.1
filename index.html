<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài Thi Thử IOE Lớp 3</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans antialiased text-gray-800">
    <div id="root"></div>

    <script type="text/babel">
        // --- DATA (from constants.ts) ---
        const QUESTIONS = [
            { type: 'mc', question: "Which word has the underlined part pronounced like the letter ‘e’ in ’’r<b>e</b>d’’?", options: [ { text: 'A. table', isCorrect: false }, { text: 'B. bed', isCorrect: true }, { text: 'C. quiet', isCorrect: false }, { text: 'D. listen', isCorrect: false } ], correctAnswer: 'B. bed', correctAnswer_vi: 'Giường', hint_vi: "Tìm từ có âm /e/ giống như trong từ 'red'.", rationale_vi: "Chữ 'e' trong 'bed' được phát âm là /e/, giống với âm của 'e' trong 'red'. Các từ khác có phát âm khác.", rationale_en: "The 'e' in 'bed' is pronounced /e/, the same as the 'e' in 'red'. The other words have different pronunciations." },
            { type: 'rearrange', question: 'Sắp xếp các từ sau thành câu đúng:', words: ['What', 'colour', 'is', 'this?'], correctAnswer: 'What colour is this?', correctAnswer_vi: 'Đây là màu gì?', hint_vi: 'Đây là câu hỏi về màu sắc, bắt đầu bằng "What colour".', rationale_vi: 'Cấu trúc câu hỏi về màu sắc là "What colour is + [vật]?".', rationale_en: 'The question structure for color is "What colour is + [object]?".' },
            { type: 'fill-in-the-blank', question: 'See you la__er.', correctAnswer: 't', correctAnswer_vi: 't (để hoàn thành "later")', hint_vi: 'Từ này có nghĩa là "sau". (1 ký tự)', rationale_vi: 'Từ cần điền là "later" trong cụm từ "See you later" (Hẹn gặp lại sau).', rationale_en: 'The missing letter completes the word "later" in the phrase "See you later".' },
            { type: 'multimedia', question: '_NE, TWO, THREE', mediaType: 'image', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Images/1-dt-22.jpg', correctAnswer: 'o', correctAnswer_vi: 'o (để hoàn thành "ONE")', hint_vi: 'Chữ cái còn thiếu để tạo thành một số đếm. (1 ký tự)', rationale_vi: 'Từ cần hoàn thành là "ONE", số một trong tiếng Anh.', rationale_en: 'The missing letter completes the word "ONE", the number one.' },
            { type: 'fill-in-the-blank', question: 'I want to st__y at home.', correctAnswer: 'a', correctAnswer_vi: 'a (để hoàn thành "stay")', hint_vi: 'Động từ này có nghĩa là "ở lại". (1 ký tự)', rationale_vi: 'Từ cần điền là "stay" (ở lại).', rationale_en: 'The missing letter completes the word "stay".' },
            { type: 'multimedia', question: 'Listen and fill in the blank: ____', mediaType: 'audio', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/11/30/636791917314960573_Audio.mp3', audioContent: 'that', correctAnswer: 'that', correctAnswer_vi: 'kia/đó', hint_vi: 'Từ có nghĩa là "kia" hoặc "đó". (4 ký tự)', rationale_vi: 'Đoạn audio đọc từ "that".', rationale_en: 'The audio says the word "that".' },
            { type: 'mc', question: 'Thank you very much. - You ... welcome.', options: [ { text: 'A. is', isCorrect: false }, { text: 'B. am', isCorrect: false }, { text: 'C. are', isCorrect: true }, { text: 'D. isn’t', isCorrect: false } ], correctAnswer: 'C. are', correctAnswer_vi: 'are', hint_vi: 'Cụm từ đáp lại lời cảm ơn.', rationale_vi: 'Cụm từ cố định là "You are welcome" (Không có gì).', rationale_en: 'The fixed phrase is "You are welcome".' },
            { type: 'multimedia', question: 'Listen and fill in the blank: ____', mediaType: 'audio', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/11/30/636791924369289479_Audio.mp3', audioContent: 'ball', correctAnswer: 'ball', correctAnswer_vi: 'quả bóng', hint_vi: 'Một đồ vật dùng để chơi thể thao. (4 ký tự)', rationale_vi: 'Đoạn audio đọc từ "ball".', rationale_en: 'The audio says the word "ball".' },
            { type: 'mc', question: "Is your ruler short? - No, it isn't. It's ____ .", options: [ { text: 'A. large', isCorrect: false }, { text: 'B. big', isCorrect: false }, { text: 'C. long', isCorrect: true }, { text: 'D. small', isCorrect: false } ], correctAnswer: 'C. long', correctAnswer_vi: 'dài', hint_vi: 'Tìm từ trái nghĩa với "short" (ngắn).', rationale_vi: 'Từ trái nghĩa với "short" (ngắn) khi nói về kích thước của thước kẻ là "long" (dài).', rationale_en: 'The opposite of "short" in the context of a ruler is "long".' },
            { type: 'fill-in-the-blank', question: 'Thank you very m__h.', correctAnswer: 'uc', correctAnswer_vi: 'uc (để hoàn thành "much")', hint_vi: 'Từ này có nghĩa là "nhiều". (2 ký tự)', rationale_vi: 'Từ cần điền là "much" trong cụm từ "Thank you very much".', rationale_en: 'The missing letters complete the word "much".' },
            { type: 'rearrange', question: 'Sắp xếp các từ sau thành câu đúng:', words: ['Can', 'you', 'sing', 'a', 'song?'], correctAnswer: 'Can you sing a song?', correctAnswer_vi: 'Bạn có thể hát một bài hát không?', hint_vi: 'Đây là câu hỏi về khả năng, bắt đầu bằng "Can".', rationale_vi: 'Cấu trúc câu hỏi với "Can" là "Can + chủ ngữ + động từ + ...?".', rationale_en: 'The question structure with "Can" is "Can + subject + verb + ...?".' },
            { type: 'mc', question: '... to meet you!', options: [ { text: 'A. How', isCorrect: false }, { text: 'B. Go', isCorrect: false }, { text: 'C. Nice', isCorrect: true }, { text: 'D. Get', isCorrect: false } ], correctAnswer: 'C. Nice', correctAnswer_vi: 'Rất vui', hint_vi: 'Đây là một câu chào hỏi thông dụng.', rationale_vi: 'Cụm từ chào hỏi thông dụng là "Nice to meet you" (Rất vui được gặp bạn).', rationale_en: 'The common greeting phrase is "Nice to meet you".' },
            { type: 'fill-in-the-blank', question: 'This is m_ cat.', correctAnswer: 'y', correctAnswer_vi: 'y (để hoàn thành "my")', hint_vi: 'Tính từ sở hữu có nghĩa là "của tôi". (1 ký tự)', rationale_vi: 'Tính từ sở hữu cho "I" là "my".', rationale_en: 'The possessive adjective for "I" is "my".' },
            { type: 'multimedia', question: 'Do you like ... TV? – Yes, I do.', mediaType: 'image', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2014/11/18/635519201705499605_566X320.jpg', imagePrompt: 'A child watching television.', options: [ { text: 'A. seeing', isCorrect: false }, { text: 'B. looking', isCorrect: false }, { text: 'C. watching', isCorrect: true }, { text: 'D. reading', isCorrect: false } ], correctAnswer: 'C. watching', correctAnswer_vi: 'xem', hint_vi: 'Động từ nào đi với TV?', rationale_vi: 'Động từ "watching" được dùng khi nói về việc xem TV.', rationale_en: 'The verb "watching" is used for television.' },
            { type: 'fill-in-the-blank', question: '__ this a ruler? – Yes, it is.', correctAnswer: 'Is', correctAnswer_vi: 'Is', hint_vi: 'Câu hỏi Yes/No với "it". (2 ký tự)', rationale_vi: 'Câu hỏi Yes/No với chủ ngữ "it" bắt đầu bằng "Is".', rationale_en: 'Yes/No questions with the subject "it" start with "Is".' },
            { type: 'multimedia', question: 'This is the ________ room.', mediaType: 'audio', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206365802440185_Audio.mp3', audioContent: 'computer', correctAnswer: 'computer', correctAnswer_vi: 'máy tính', hint_vi: 'máy vi tính. (6 ký tự)', rationale_vi: 'Đoạn audio đọc từ "computer", tạo thành "computer room" (phòng khách).', rationale_en: 'The audio says "comuputer", forming "computer room".' },
            { type: 'mc', question: 'A: _________. - B: Yes, you can', options: [ { text: 'A. Open your book!', isCorrect: false }, { text: 'B. Stand up!', isCorrect: false }, { text: 'C. May I go out?', isCorrect: true }, { text: 'D. Be quiet!', isCorrect: false } ], correctAnswer: 'C. May I go out?', correctAnswer_vi: 'Em có thể ra ngoài không?', hint_vi: 'Câu trả lời là sự cho phép.', rationale_vi: 'Câu trả lời "Yes, you can" dùng để cho phép, phù hợp với câu hỏi xin phép "May I go out?".', rationale_en: 'The answer "Yes, you can" grants permission, which fits the request "May I go out?".' },
            { type: 'multimedia', question: '____ the words aloud.', mediaType: 'image', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2019/11/29/637106206447289871_566X320.jpg', imagePrompt: 'A person reading a book.', correctAnswer: 'Read', correctAnswer_vi: 'Đọc', hint_vi: 'Hành động liên quan đến sách và từ ngữ. (4 ký tự)', rationale_vi: 'Hành động đọc to các từ là "Read the words aloud".', rationale_en: 'The action of reading words out loud is "Read the words aloud".' },
            { type: 'fill-in-the-blank', question: 'Wh_ is that? – It’s Mary.', correctAnswer: 'o', correctAnswer_vi: 'o (để hoàn thành "Who")', hint_vi: 'Từ để hỏi về người. (1 ký tự)', rationale_vi: 'Câu trả lời là một người ("Mary"), nên câu hỏi phải bắt đầu bằng "Who".', rationale_en: 'The answer is a person ("Mary"), so the question must start with "Who".' },
            { type: 'multimedia', question: '_______ table tennis.', mediaType: 'audio', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Audio/4-tn-24.mp3', audioContent: 'I play table tennis.', options: [ { text: 'A. Peter plays', isCorrect: false }, { text: 'B. I play', isCorrect: true }, { text: 'C. Mai plays', isCorrect: false }, { text: 'D. My friends play', isCorrect: false } ], correctAnswer: 'B. I play', correctAnswer_vi: 'Tôi chơi', hint_vi: 'Lắng nghe kỹ chủ ngữ và động từ.', rationale_vi: 'Đoạn audio đọc câu "I play table tennis".', rationale_en: 'The audio says "I play table tennis".' },
            { type: 'fill-in-the-blank', question: 'G__e me the book, please.', correctAnswer: 'iv', correctAnswer_vi: 'iv (để hoàn thành "Give")', hint_vi: 'Động từ có nghĩa là "đưa cho". (2 ký tự)', rationale_vi: 'Động từ cần điền là "Give" (đưa cho).', rationale_en: 'The missing letters complete the verb "Give".' },
            { type: 'multimedia', question: "It's a ____ computer.", mediaType: 'image', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi%20Th%E1%BB%AD/Thi_trai_nghiem_2021/Lop3/images/tn-28.jpg', imagePrompt: 'A green computer.', options: [ { text: 'A. green', isCorrect: true }, { text: 'B. blue', isCorrect: false }, { text: 'C. red', isCorrect: false }, { text: 'D. black', isCorrect: false } ], correctAnswer: 'A. green', correctAnswer_vi: 'màu xanh lá', hint_vi: 'Nhìn vào màu sắc của máy tính trong hình.', rationale_vi: 'Hình ảnh cho thấy một chiếc máy tính màu xanh lá (green).', rationale_en: 'The image shows a green computer.' },
            { type: 'fill-in-the-blank', question: 'This is _ green doll.', correctAnswer: 'a', correctAnswer_vi: 'a', hint_vi: 'Mạo từ không xác định. (1 ký tự)', rationale_vi: 'Dùng mạo từ "a" trước một danh từ đếm được số ít bắt đầu bằng phụ âm ("green").', rationale_en: 'Use the article "a" before a singular countable noun starting with a consonant sound ("green").' },
            { type: 'mc', question: 'I am fine. ... you?', options: [ { text: 'A. End', isCorrect: false }, { text: 'B. And', isCorrect: true }, { text: 'C. An', isCorrect: false }, { text: 'D. At', isCorrect: false } ], correctAnswer: 'B. And', correctAnswer_vi: 'Và', hint_vi: 'Từ dùng để hỏi lại người khác.', rationale_vi: 'Cụm từ "And you?" được dùng để hỏi lại câu hỏi tương tự (trong trường hợp này là "How are you?").', rationale_en: 'The phrase "And you?" is used to ask the same question back.' },
            { type: 'mc', question: 'Choose the odd one out:', options: [ { text: 'A. are', isCorrect: false }, { text: 'B. you', isCorrect: true }, { text: 'C. am', isCorrect: false }, { text: 'D. is', isCorrect: false } ], correctAnswer: 'B. you', correctAnswer_vi: 'bạn', hint_vi: 'Ba từ là dạng của động từ "to be".', rationale_vi: '"are", "am", "is" là các dạng của động từ "to be". "you" là một đại từ.', rationale_en: '"are", "am", "is" are forms of the verb "to be". "you" is a pronoun.' },
            { type: 'fill-in-the-blank', question: 'C__e over here.', correctAnswer: 'om', correctAnswer_vi: 'om (để hoàn thành "Come")', hint_vi: 'Động từ có nghĩa là "đến đây". (2 ký tự)', rationale_vi: 'Động từ "Come" trong cụm "Come over here".', rationale_en: 'The verb is "Come" in the phrase "Come over here".' },
            { type: 'fill-in-the-blank', question: 'It is __ ice-cream.', correctAnswer: 'an', correctAnswer_vi: 'an', hint_vi: 'Mạo từ không xác định. (2 ký tự)', rationale_vi: 'Dùng mạo từ "an" trước một danh từ đếm được số ít bắt đầu bằng nguyên âm ("ice-cream").', rationale_en: 'Use the article "an" before a singular countable noun starting with a vowel sound ("ice-cream").' },
            { type: 'rearrange', question: 'Sắp xếp các từ sau thành câu đúng:', words: ['This', 'is', 'a', 'yellow', 'hat.'], correctAnswer: 'This is a yellow hat.', correctAnswer_vi: 'Đây là một cái mũ màu vàng.', hint_vi: 'Bắt đầu bằng "This is".', rationale_vi: 'Cấu trúc câu giới thiệu: "This is + a/an + tính từ + danh từ".', rationale_en: 'Sentence structure: "This is + a/an + adjective + noun".' },
            { type: 'fill-in-the-blank', question: 'There are t__ee crayons in my bags.', correctAnswer: 'hr', correctAnswer_vi: 'hr (để hoàn thành "three")', hint_vi: 'Đây là số 3. (2 ký tự)', rationale_vi: 'Từ cần điền là "three" (số 3).', rationale_en: 'The missing letters complete the word "three".' },
            { type: 'fill-in-the-blank', question: 'L__k at the board, please.', correctAnswer: 'oo', correctAnswer_vi: 'oo (để hoàn thành "Look")', hint_vi: 'Động từ có nghĩa là "nhìn". (2 ký tự)', rationale_vi: 'Cụm từ "Look at" có nghĩa là "nhìn vào".', rationale_en: 'The phrasal verb "Look at" means to direct your eyes towards something.' },
            { type: 'multimedia', question: 'There are ____ books in the bookcase.', mediaType: 'audio', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206305601154447_Audio.mp3', audioContent: 'five', correctAnswer: 'five', correctAnswer_vi: 'năm', hint_vi: 'Lắng nghe số lượng sách. (4 ký tự)', rationale_vi: 'Đoạn audio đọc "There are five books...".', rationale_en: 'The audio says "There are five books...".' },
            { type: 'multimedia', question: '____ brown books.', mediaType: 'image', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Images/1-tn-51.jpg', imagePrompt: 'Two brown books.', options: [ { text: 'A. There are', isCorrect: false }, { text: 'B. They are', isCorrect: true }, { text: 'C. It is', isCorrect: false }, { text: 'D. It\'s is', isCorrect: false } ], correctAnswer: 'B. They are', correctAnswer_vi: 'Chúng là', hint_vi: 'Hình ảnh có nhiều hơn một quyển sách.', rationale_vi: 'Vì có hai quyển sách (số nhiều), chúng ta dùng "They are".', rationale_en: 'Since there are two books (plural), we use "They are".' },
            { type: 'mc', question: 'Choose the odd one out:', options: [ { text: 'A. frog', isCorrect: false }, { text: 'B. desk', isCorrect: true }, { text: 'C. tiger', isCorrect: false }, { text: 'D. lion', isCorrect: false } ], correctAnswer: 'B. desk', correctAnswer_vi: 'cái bàn', hint_vi: 'Ba từ là con vật.', rationale_vi: '"frog", "tiger", "lion" là các con vật. "desk" là đồ vật.', rationale_en: '"frog", "tiger", "lion" are animals. "desk" is an object.' },
            { type: 'mc', question: 'Jack ___ in the playground.', options: [ { text: 'A. are', isCorrect: false }, { text: 'B. am', isCorrect: false }, { text: 'C. is', isCorrect: true }, { text: 'D. be', isCorrect: false } ], correctAnswer: 'C. is', correctAnswer_vi: 'is', hint_vi: 'Động từ "to be" cho ngôi thứ ba số ít.', rationale_vi: 'Chủ ngữ "Jack" (ngôi thứ ba số ít) đi với động từ "to be" là "is".', rationale_en: 'The subject "Jack" (third-person singular) goes with the verb "is".' },
            { type: 'rearrange', question: 'Sắp xếp các từ sau thành câu đúng:', words: ['May', 'I', 'ask', 'you', 'a question?'], correctAnswer: 'May I ask you a question?', correctAnswer_vi: 'Tôi có thể hỏi bạn một câu được không?', hint_vi: 'Câu xin phép bắt đầu bằng "May I".', rationale_vi: 'Cấu trúc câu xin phép: "May I + động từ + ...?".', rationale_en: 'Permission request structure: "May I + verb + ...?".' },
            { type: 'rearrange', question: 'Sắp xếp các từ sau thành câu đúng:', words: ['That', 'is', 'my', 'new', 'backpack.'], correctAnswer: 'That is my new backpack.', correctAnswer_vi: 'Đó là cái ba lô mới của tôi.', hint_vi: 'Câu giới thiệu đồ vật ở xa.', rationale_vi: 'Cấu trúc câu: "That is + tính từ sở hữu + tính từ + danh từ".', rationale_en: 'Sentence structure: "That is + possessive adjective + adjective + noun".' },
            { type: 'multimedia', question: 'Is your school bag y______? - Yes, it is.', mediaType: 'image', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/22/635207370933834230_566X320.jpg', imagePrompt: 'A yellow school bag.', correctAnswer: 'ellow', correctAnswer_vi: 'ellow (để hoàn thành "yellow")', hint_vi: 'Màu sắc của cặp sách trong hình. (5 ký tự)', rationale_vi: 'Hình ảnh cho thấy một chiếc cặp màu vàng (yellow).', rationale_en: 'The image shows a yellow school bag.' },
            { type: 'rearrange', question: 'Sắp xếp các từ sau thành câu đúng:', words: ['That', 'ruler', 'is', 'pink.'], correctAnswer: 'That ruler is pink.', correctAnswer_vi: 'Cái thước đó màu hồng.', hint_vi: 'Chủ ngữ là "That ruler".', rationale_vi: 'Cấu trúc câu: "Chủ ngữ + to be + tính từ".', rationale_en: 'Sentence structure: "Subject + to be + adjective".' },
            { type: 'mc', question: 'What’s ... name?', options: [ { text: 'A. she', isCorrect: false }, { text: 'B. he', isCorrect: false }, { text: 'C. you', isCorrect: false }, { text: 'D. her', isCorrect: true } ], correctAnswer: 'D. her', correctAnswer_vi: 'của cô ấy', hint_vi: 'Cần một tính từ sở hữu.', rationale_vi: 'Để hỏi tên của một người nữ, ta dùng tính từ sở hữu "her".', rationale_en: 'To ask for a female person\'s name, we use the possessive adjective "her".' },
            { type: 'fill-in-the-blank', question: 'I have __ apple.', correctAnswer: 'an', correctAnswer_vi: 'an', hint_vi: 'Mạo từ đứng trước một nguyên âm. (2 ký tự)', rationale_vi: 'Dùng "an" trước "apple" vì "apple" bắt đầu bằng một nguyên âm.', rationale_en: 'Use "an" before "apple" because it starts with a vowel sound.' },
            { type: 'multimedia', question: 'He’s ______ years old.', mediaType: 'audio', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206316507133602_Audio.mp3', audioContent: 'eight', correctAnswer: 'eight', correctAnswer_vi: 'tám', hint_vi: 'Lắng nghe tuổi của cậu bé. (5 ký tự)', rationale_vi: 'Đoạn audio nói "He\'s eight years old".', rationale_en: 'The audio says "He\'s eight years old".' },
            { type: 'rearrange', question: 'Sắp xếp các từ sau thành câu đúng:', words: ['Quan', 'is', 'seven', 'years old.'], correctAnswer: 'Quan is seven years old.', correctAnswer_vi: 'Quân bảy tuổi.', hint_vi: 'Bắt đầu bằng tên riêng.', rationale_vi: 'Cấu trúc câu nói về tuổi: "Tên + is + số tuổi + years old".', rationale_en: 'Sentence structure for age: "Name + is + number + years old".' },
            { type: 'rearrange', question: 'Sắp xếp các từ sau thành câu đúng:', words: ['Let’s', 'make', 'a', 'circle.'], correctAnswer: 'Let’s make a circle.', correctAnswer_vi: 'Chúng ta hãy tạo một vòng tròn.', hint_vi: 'Câu đề nghị bắt đầu bằng "Let\'s".', rationale_vi: 'Cấu trúc câu đề nghị: "Let\'s + động từ nguyên mẫu".', rationale_en: 'Suggestion structure: "Let\'s + base verb".' },
            { type: 'fill-in-the-blank', question: 'I_ is a crayon.', correctAnswer: 't', correctAnswer_vi: 't (để hoàn thành "It")', hint_vi: 'Chủ ngữ giả cho đồ vật. (1 ký tự)', rationale_vi: 'Chủ ngữ "It" được dùng để chỉ đồ vật.', rationale_en: 'The subject "It" is used to refer to an object.' },
            { type: 'multimedia', question: 'CA_', mediaType: 'image', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Images/1-dt-52.jpg', imagePrompt: 'A cat.', correctAnswer: 'T', correctAnswer_vi: 'T (để hoàn thành "CAT")', hint_vi: 'Tên một loài vật nuôi. (1 ký tự)', rationale_vi: 'Hình ảnh cho thấy một con mèo (CAT).', rationale_en: 'The image shows a cat (CAT).' },
            { type: 'fill-in-the-blank', question: 'Se_ you again.', correctAnswer: 'e', correctAnswer_vi: 'e (để hoàn thành "See")', hint_vi: 'Động từ trong câu chào tạm biệt. (1 ký tự)', rationale_vi: 'Cụm từ "See you again" (Hẹn gặp lại).', rationale_en: 'The phrase is "See you again".' },
            { type: 'fill-in-the-blank', question: 'To__h your desk, please.', correctAnswer: 'uc', correctAnswer_vi: 'uc (để hoàn thành "Touch")', hint_vi: 'Động từ có nghĩa là "chạm vào". (2 ký tự)', rationale_vi: 'Động từ "Touch" (chạm vào).', rationale_en: 'The verb is "Touch".' },
            { type: 'mc', question: 'Choose the incorrect word(s) in the following sentence: These are my notebook.', options: [ { text: 'A. These', isCorrect: false }, { text: 'B. are', isCorrect: false }, { text: 'C. my', isCorrect: false }, { text: 'D. notebook', isCorrect: true } ], correctAnswer: 'D. notebook', correctAnswer_vi: 'notebook', hint_vi: 'Chủ ngữ "These" là số nhiều.', rationale_vi: 'Vì chủ ngữ là "These are" (số nhiều), danh từ phải ở dạng số nhiều là "notebooks".', rationale_en: 'Because the subject is "These are" (plural), the noun must be in plural form: "notebooks".' },
            { type: 'fill-in-the-blank', question: 'This is my classr__m.', correctAnswer: 'oo', correctAnswer_vi: 'oo (để hoàn thành "classroom")', hint_vi: 'Từ này có nghĩa là "phòng học". (2 ký tự)', rationale_vi: 'Từ cần điền là "classroom" (phòng học).', rationale_en: 'The missing letters complete the word "classroom".' },
            { type: 'mc', question: '…, students. See you tomorrow.', options: [ { text: 'A. Good morning', isCorrect: false }, { text: 'B. Good night', isCorrect: false }, { text: 'C. Goodbye', isCorrect: true }, { text: 'D. Nice to meet you', isCorrect: false } ], correctAnswer: 'C. Goodbye', correctAnswer_vi: 'Tạm biệt', hint_vi: 'Câu đi kèm là "See you tomorrow".', rationale_vi: 'Cụm từ "See you tomorrow" (Hẹn gặp lại vào ngày mai) thường đi sau lời chào tạm biệt "Goodbye".', rationale_en: '"See you tomorrow" usually follows the farewell "Goodbye".' },
            { type: 'mc', question: '... ? – It’s yellow.', options: [ { text: 'A. What colour is it', isCorrect: true }, { text: 'B. What is this', isCorrect: false }, { text: 'C. Is this yellow', isCorrect: false }, { text: 'D. This is yellow pen', isCorrect: false } ], correctAnswer: 'A. What colour is it', correctAnswer_vi: 'Nó màu gì?', hint_vi: 'Câu trả lời là về màu sắc.', rationale_vi: 'Câu trả lời "It\'s yellow" (Nó màu vàng) dùng để trả lời cho câu hỏi "What colour is it?".', rationale_en: 'The answer "It\'s yellow" responds to the question "What colour is it?".' },
            { type: 'multimedia', question: 'We are ______ at break time.', mediaType: 'image', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Images/1-tn-59.jpg', imagePrompt: 'Children playing in a playground.', options: [ { text: 'A. in the classroom', isCorrect: false }, { text: 'B. in the computer room', isCorrect: false }, { text: 'C. in the playground', isCorrect: true }, { text: 'D. on the roof', isCorrect: false } ], correctAnswer: 'C. in the playground', correctAnswer_vi: 'trong sân chơi', hint_vi: 'Nơi học sinh thường chơi vào giờ giải lao.', rationale_vi: 'Hình ảnh cho thấy học sinh đang ở trong sân chơi.', rationale_en: 'The image shows students in the playground.' },
            { type: 'mc', question: 'Close your ..., please.', options: [ { text: 'A. name', isCorrect: false }, { text: 'B. book', isCorrect: true }, { text: 'C. ball', isCorrect: false }, { text: 'D. took', isCorrect: false } ], correctAnswer: 'B. book', correctAnswer_vi: 'sách', hint_vi: 'Hành động "Close" (đóng/gấp lại) thường đi với đồ vật nào?', rationale_vi: 'Cụm từ "Close your book" (Gấp sách lại) là một yêu cầu phổ biến trong lớp học.', rationale_en: '"Close your book" is a common classroom instruction.' },
            { type: 'multimedia', question: "Unscramble this word: ’’AERSRE’’ -> ’’ERAS____’’.", mediaType: 'image', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Images/2-dt-67.jpg', imagePrompt: 'An eraser.', correctAnswer: 'ER', correctAnswer_vi: 'ER (để hoàn thành "ERASER")', hint_vi: 'Sắp xếp lại các chữ cái để tạo thành một đồ dùng học tập. (2 ký tự)', rationale_vi: 'Các chữ cái "AERSRE" khi sắp xếp lại sẽ tạo thành từ "ERASER" (cục tẩy).', rationale_en: 'The letters "AERSRE" unscramble to "ERASER".' },
            { type: 'fill-in-the-blank', question: 'Is that your pencil? – No, it is ___ .', correctAnswer: 'not', correctAnswer_vi: 'not (không)', hint_vi: 'Từ dùng trong câu trả lời phủ định. (3 ký tự)', rationale_vi: 'Câu trả lời phủ định đầy đủ là "No, it is not".', rationale_en: 'The full negative answer is "No, it is not".' },
            { type: 'fill-in-the-blank', question: "My school isn't new. It's _ld.", correctAnswer: 'o', correctAnswer_vi: 'o (để hoàn thành "old")', hint_vi: 'Từ trái nghĩa với "new". (1 ký tự)', rationale_vi: 'Từ trái nghĩa với "new" (mới) là "old" (cũ).', rationale_en: 'The opposite of "new" is "old".' },
            { type: 'mc', question: 'I … a blue pencil and a white ruler.', options: [ { text: 'A. has', isCorrect: false }, { text: 'B. have', isCorrect: true }, { text: 'C. don’t have', isCorrect: false }, { text: 'D. doesn’t have', isCorrect: false } ], correctAnswer: 'B. have', correctAnswer_vi: 'có', hint_vi: 'Động từ "có" đi với chủ ngữ "I".', rationale_vi: 'Chủ ngữ "I" đi với động từ "have".', rationale_en: 'The subject "I" is used with the verb "have".' },
            { type: 'mc', question: 'Do you like _______ TV?', options: [ { text: 'A. playing', isCorrect: false }, { text: 'B. watching', isCorrect: true }, { text: 'C. reading', isCorrect: false }, { text: 'D. talking', isCorrect: false } ], correctAnswer: 'B. watching', correctAnswer_vi: 'xem', hint_vi: 'Động từ "like" đi với V-ing. Động từ nào dùng cho TV?', rationale_vi: 'Sau "like" là V-ing, và động từ đi với TV là "watch". Do đó, đáp án là "watching".', rationale_en: 'After "like" comes a gerund (V-ing), and the verb used for TV is "watch". Thus, the answer is "watching".' },
            { type: 'mc', question: 'Look … your book, please.', options: [ { text: 'A. of', isCorrect: false }, { text: 'B. in', isCorrect: false }, { text: 'C. on', isCorrect: false }, { text: 'D. at', isCorrect: true } ], correctAnswer: 'D. at', correctAnswer_vi: 'vào', hint_vi: 'Giới từ đi với "Look".', rationale_vi: 'Cụm động từ "Look at" có nghĩa là "nhìn vào".', rationale_en: 'The phrasal verb is "Look at".' },
            { type: 'mc', question: 'He has a ... .', options: [ { text: 'A. sunny', isCorrect: false }, { text: 'B. cloudy', isCorrect: false }, { text: 'C. windy', isCorrect: false }, { text: 'D. doll', isCorrect: true } ], correctAnswer: 'D. doll', correctAnswer_vi: 'búp bê', hint_vi: '"He has a" cần một danh từ. Ba lựa chọn còn lại là tính từ chỉ thời tiết.', rationale_vi: 'Chỉ có "doll" (búp bê) là danh từ chỉ đồ vật mà một người có thể sở hữu. Các từ còn lại là tính từ.', rationale_en: 'Only "doll" is a noun that a person can have. The other options are adjectives.' },
            { type: 'multimedia', question: 'Who’s that?', mediaType: 'audio', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/11/30/636792045794426753_Audio.mp3', audioContent: 'Linda', options: [ { text: 'A. Mary', isCorrect: false }, { text: 'B. Jane', isCorrect: false }, { text: 'C. Linda', isCorrect: true }, { text: 'D. Ellie', isCorrect: false } ], correctAnswer: 'C. Linda', correctAnswer_vi: 'Linda', hint_vi: 'Lắng nghe tên người được nhắc đến.', rationale_vi: 'Đoạn audio trả lời câu hỏi "Who\'s that?" bằng tên "Linda".', rationale_en: 'The audio answers the question "Who\'s that?" with the name "Linda".' },
            { type: 'multimedia', question: 'These are th___ dogs.', mediaType: 'image', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/23/635208317825499792_566X320.jpg', imagePrompt: 'Three dogs.', correctAnswer: 'ree', correctAnswer_vi: 'ree (để hoàn thành "three")', hint_vi: 'Đếm số con vật trong hình. (3 ký tự)', rationale_vi: 'Hình ảnh cho thấy có ba con chó (three dogs).', rationale_en: 'The image shows three dogs.' },
            { type: 'fill-in-the-blank', question: 'That is my fr__nd.', correctAnswer: 'ie', correctAnswer_vi: 'ie (để hoàn thành "friend")', hint_vi: 'Từ này có nghĩa là "bạn bè". (2 ký tự)', rationale_vi: 'Từ cần điền là "friend" (bạn).', rationale_en: 'The missing letters complete the word "friend".' },
            { type: 'multimedia', question: "It's my school ____ room.", mediaType: 'image', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Images/3-tn-28.jpg', imagePrompt: 'A lunch room.', options: [ { text: 'A. music', isCorrect: false }, { text: 'B. art', isCorrect: false }, { text: 'C. lunch', isCorrect: true }, { text: 'D. computer', isCorrect: false } ], correctAnswer: 'C. lunch', correctAnswer_vi: 'phòng ăn trưa', hint_vi: 'Căn phòng dành cho ăn trưa.', rationale_vi: 'Hình ảnh cho thấy một phòng ăn trưa.', rationale_en: 'The image shows a lunch room.' },
            { type: 'mc', question: 'What is her name? - ... .', options: [ { text: 'A. He name is Peter', isCorrect: false }, { text: 'B. His name Peter', isCorrect: false }, { text: 'C. Her name Sammy', isCorrect: false }, { text: 'D. Her name is Sammy', isCorrect: true } ], correctAnswer: 'D. Her name is Sammy', correctAnswer_vi: 'Tên cô ấy là Sammy', hint_vi: 'Câu trả lời phải đầy đủ cấu trúc và đúng giới tính.', rationale_vi: 'Câu hỏi là "her name" nên câu trả lời phải là "Her name is...". Các đáp án khác sai về giới tính hoặc thiếu động từ "is".', rationale_en: 'The question is about "her name", so the answer must be "Her name is...". Other options are grammatically incorrect or use the wrong gender.' },
            { type: 'multimedia', question: 'What AREN’T the students doing?', mediaType: 'audio', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2016/11/30/636161038579274971_Audio.mp3', audioContent: 'The students are running, jumping, and laughing.', options: [ { text: 'A. Running', isCorrect: false }, { text: 'B. Jumping', isCorrect: false }, { text: 'C. Laughing', isCorrect: false }, { text: 'D. Studying', isCorrect: true } ], correctAnswer: 'D. Studying', correctAnswer_vi: 'Học bài', hint_vi: 'Nghe xem học sinh đang làm gì và chọn hành động không được nhắc đến.', rationale_vi: 'Đoạn audio mô tả học sinh đang chạy (running), nhảy (jumping) và cười (laughing). Hành động không được nhắc đến là học bài (studying).', rationale_en: 'The audio describes students running, jumping, and laughing. The activity not mentioned is studying.' },
            { type: 'rearrange', question: 'Sắp xếp các từ sau thành câu đúng:', words: ['Tony and I', 'are', 'in', 'class 3A.'], correctAnswer: 'Tony and I are in class 3A.', correctAnswer_vi: 'Tony và tôi học lớp 3A.', hint_vi: 'Chủ ngữ là "Tony and I".', rationale_vi: 'Cấu trúc câu: "Chủ ngữ + to be + cụm giới từ".', rationale_en: 'Sentence structure: "Subject + to be + prepositional phrase".' },
            { type: 'mc', question: "Is your classroom big? - …, it isn't. It’s small.", options: [ { text: 'A. Yes', isCorrect: false }, { text: 'B. Yes, it isn’t', isCorrect: false }, { text: 'C. No, it is', isCorrect: false }, { text: 'D. No', isCorrect: true } ], correctAnswer: 'D. No', correctAnswer_vi: 'Không', hint_vi: 'Vế sau của câu trả lời là "it isn\'t".', rationale_vi: 'Câu trả lời phủ định "it isn\'t" phải đi với "No".', rationale_en: 'The negative contraction "it isn\'t" must be preceded by "No".' },
            { type: 'mc', question: 'You ... Richard. You are a new student in my class.', options: [ { text: 'A. is', isCorrect: false }, { text: 'B. be', isCorrect: false }, { text: 'C. are', isCorrect: true }, { text: 'D. am', isCorrect: false } ], correctAnswer: 'C. are', correctAnswer_vi: 'are', hint_vi: 'Động từ "to be" đi với chủ ngữ "You".', rationale_vi: 'Chủ ngữ "You" đi với động từ "to be" là "are".', rationale_en: 'The subject "You" is used with the verb "are".' },
            { type: 'fill-in-the-blank', question: 'Please, be q__et.', correctAnswer: 'ui', correctAnswer_vi: 'ui (để hoàn thành "quiet")', hint_vi: 'Từ này có nghĩa là "yên lặng". (2 ký tự)', rationale_vi: 'Tính từ cần điền là "quiet" (yên lặng).', rationale_en: 'The missing letters complete the adjective "quiet".' },
            { type: 'multimedia', question: 'Th___ are my pencils.', mediaType: 'audio', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2019/11/29/637106246058223806_Audio.mp3', audioContent: 'Those', correctAnswer: 'ose', correctAnswer_vi: 'ose (để hoàn thành "Those")', hint_vi: 'Lắng nghe từ chỉ định số nhiều. (3 ký tự)', rationale_vi: 'Đoạn audio nói "Those are my pencils".', rationale_en: 'The audio says "Those are my pencils".' },
            { type: 'fill-in-the-blank', question: 'TEACH__R', correctAnswer: 'E', correctAnswer_vi: 'E (để hoàn thành "TEACHER")', hint_vi: 'Chức danh của người dạy học. (1 ký tự)', rationale_vi: 'Từ cần điền là "TEACHER" (giáo viên).', rationale_en: 'The missing letter completes the word "TEACHER".' },
            { type: 'rearrange', question: 'Sắp xếp các từ sau thành câu đúng:', words: ['Please', 'close', 'your', 'books.'], correctAnswer: 'Please close your books.', correctAnswer_vi: 'Làm ơn hãy gấp sách lại.', hint_vi: 'Câu mệnh lệnh lịch sự bắt đầu bằng "Please".', rationale_vi: 'Cấu trúc câu mệnh lệnh: "Please + động từ + ...".', rationale_en: 'Imperative sentence structure: "Please + verb + ...".' },
            { type: 'mc', question: 'What’s _______ name?', options: [ { text: 'A. you', isCorrect: false }, { text: 'B. I', isCorrect: false }, { text: 'C. his', isCorrect: true }, { text: 'D. he', isCorrect: false } ], correctAnswer: 'C. his', correctAnswer_vi: 'của anh ấy', hint_vi: 'Cần một tính từ sở hữu.', rationale_vi: 'Để hỏi tên của một người nam, ta dùng tính từ sở hữu "his".', rationale_en: 'To ask for a male person\'s name, we use the possessive adjective "his".' },
            { type: 'fill-in-the-blank', question: 'She is my tea__er.', correctAnswer: 'ch', correctAnswer_vi: 'ch (để hoàn thành "teacher")', hint_vi: 'Từ có nghĩa là "giáo viên". (2 ký tự)', rationale_vi: 'Từ cần điền là "teacher" (giáo viên).', rationale_en: 'The missing letters complete the word "teacher".' },
            { type: 'multimedia', question: 'TABLE AND CHAI_', mediaType: 'image', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Images/2-dt-29.jpg', imagePrompt: 'A chair.', correctAnswer: 'R', correctAnswer_vi: 'R (để hoàn thành "CHAIR")', hint_vi: 'Tên một đồ vật để ngồi. (1 ký tự)', rationale_vi: 'Hình ảnh cho thấy một cái ghế (CHAIR).', rationale_en: 'The image shows a chair (CHAIR).' },
            { type: 'mc', question: 'What do you do ... English lessons?', options: [ { text: 'A. on', isCorrect: false }, { text: 'B. to', isCorrect: false }, { text: 'C. near', isCorrect: false }, { text: 'D. during', isCorrect: true } ], correctAnswer: 'D. during', correctAnswer_vi: 'trong suốt', hint_vi: 'Giới từ chỉ một khoảng thời gian.', rationale_vi: '"during" được dùng để chỉ hành động xảy ra trong suốt một khoảng thời gian (tiết học tiếng Anh).', rationale_en: '"during" is used to indicate that something happens over a period of time (the English lessons).' },
            { type: 'fill-in-the-blank', question: 'There __ a pen in my school bag.', correctAnswer: 'is', correctAnswer_vi: 'is', hint_vi: 'Cấu trúc "There is/are". (2 ký tự)', rationale_vi: 'Với danh từ số ít ("a pen"), ta dùng "There is".', rationale_en: 'With a singular noun ("a pen"), we use "There is".' },
            { type: 'fill-in-the-blank', question: 'My pen is o_ the desk.', correctAnswer: 'n', correctAnswer_vi: 'n (để hoàn thành "on")', hint_vi: 'Giới từ chỉ vị trí "ở trên". (1 ký tự)', rationale_vi: 'Giới từ "on" được dùng để chỉ vật gì đó ở trên một bề mặt.', rationale_en: 'The preposition "on" is used to indicate something is on a surface.' },
            { type: 'fill-in-the-blank', question: 'This is the way we go __ school.', correctAnswer: 'to', correctAnswer_vi: 'to (đến)', hint_vi: 'Cụm từ "go to school". (2 ký tự)', rationale_vi: 'Cụm động từ cố định là "go to school" (đi học).', rationale_en: 'The fixed phrase is "go to school".' },
            { type: 'fill-in-the-blank', question: 'Put your book a__y please.', correctAnswer: 'wa', correctAnswer_vi: 'wa (để hoàn thành "away")', hint_vi: 'Cụm động từ có nghĩa là "cất đi". (2 ký tự)', rationale_vi: 'Cụm động từ "put away" có nghĩa là cất thứ gì đó đi.', rationale_en: 'The phrasal verb "put away" means to store something in its proper place.' },
            { type: 'fill-in-the-blank', question: 'Gi_e me the book, please.', correctAnswer: 'v', correctAnswer_vi: 'v (để hoàn thành "Give")', hint_vi: 'Động từ có nghĩa là "đưa cho". (1 ký tự)', rationale_vi: 'Động từ "Give" (đưa cho).', rationale_en: 'The verb is "Give".' },
            { type: 'multimedia', question: "That's my computer _oom.", mediaType: 'image', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Images/3-dt-42.jpg', imagePrompt: 'A computer room.', correctAnswer: 'r', correctAnswer_vi: 'r (để hoàn thành "room")', hint_vi: 'Từ có nghĩa là "phòng". (1 ký tự)', rationale_vi: 'Hình ảnh cho thấy một phòng máy tính (computer room).', rationale_en: 'The image shows a computer room.' },
            { type: 'rearrange', question: 'Sắp xếp các từ sau thành câu đúng:', words: ['I', 'am', 'a', 'student.'], correctAnswer: 'I am a student.', correctAnswer_vi: 'Tôi là một học sinh.', hint_vi: 'Bắt đầu bằng "I am".', rationale_vi: 'Cấu trúc câu giới thiệu bản thân: "I am + a/an + danh từ".', rationale_en: 'Sentence structure: "I am + a/an + noun".' },
            { type: 'multimedia', question: 'What are these? – These are pink ______.', mediaType: 'image', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/22/635207361299814737_566X320.jpg', imagePrompt: 'Pink dolls.', correctAnswer: 'dolls', correctAnswer_vi: 'Búp bê', hint_vi: 'Tên một đồ chơi, số nhiều. (5 ký tự)', rationale_vi: 'Hình ảnh cho thấy những con búp bê màu hồng (pink dolls).', rationale_en: 'The image shows pink dolls.' },
            { type: 'rearrange', question: 'Sắp xếp các từ sau thành câu đúng:', words: ['Hi,', 'Mary.', 'How', 'are', 'you?'], correctAnswer: 'Hi, Mary. How are you?', correctAnswer_vi: 'Chào Mary. Bạn khỏe không?', hint_vi: 'Đây là một đoạn hội thoại chào hỏi.', rationale_vi: 'Đây là một lời chào và câu hỏi thăm sức khỏe thông thường.', rationale_en: 'This is a common greeting and inquiry about someone\'s well-being.' },
            { type: 'rearrange', question: 'Sắp xếp các từ sau thành câu đúng:', words: ["I'm", 'fine,', 'thank', 'you.'], correctAnswer: "I'm fine, thank you.", correctAnswer_vi: 'Tôi khỏe, cảm ơn bạn.', hint_vi: 'Câu trả lời cho "How are you?".', rationale_vi: 'Đây là câu trả lời tiêu chuẩn cho câu hỏi "How are you?".', rationale_en: 'This is the standard response to the question "How are you?".' },
            { type: 'mc', question: 'That is a big tr...e.', options: [ { text: 'A. a', isCorrect: false }, { text: 'B. u', isCorrect: false }, { text: 'C. e', isCorrect: true }, { text: 'D. i', isCorrect: false } ], correctAnswer: 'C. e', correctAnswer_vi: 'e (để hoàn thành "tree")', hint_vi: 'Từ có nghĩa là "cái cây".', rationale_vi: 'Chữ cái còn thiếu để tạo thành từ "tree" (cái cây).', rationale_en: 'The missing letter completes the word "tree".' },
            { type: 'fill-in-the-blank', question: 'Who is she? – S_e is Mary.', correctAnswer: 'h', correctAnswer_vi: 'h (để hoàn thành "She")', hint_vi: 'Đại từ nhân xưng cho nữ giới. (1 ký tự)', rationale_vi: 'Đại từ nhân xưng cho nữ giới, ngôi thứ ba số ít là "She".', rationale_en: 'The third-person singular female pronoun is "She".' },
            { type: 'multimedia', question: 'Our ________ is not big.', mediaType: 'image', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/23/635208311247935975_566X320.jpg', imagePrompt: 'A small bathroom.', correctAnswer: 'bathroom', correctAnswer_vi: 'phòng tắm', hint_vi: 'Nơi tắm rửa. (8 ký tự)', rationale_vi: 'Hình ảnh cho thấy một phòng tắm nhỏ.', rationale_en: 'The image shows a small bathroom.' },
            { type: 'fill-in-the-blank', question: 'Is that __y your friend? - B: No, he isn’t.', correctAnswer: 'bo', correctAnswer_vi: 'bo (để hoàn thành "boy")', hint_vi: 'Từ chỉ một bạn nam. (2 ký tự)', rationale_vi: 'Từ cần điền là "boy" (cậu bé).', rationale_en: 'The missing letters complete the word "boy".' },
            { type: 'rearrange', question: 'Sắp xếp các từ sau thành câu đúng:', words: ['Hi,', 'I’m', 'John.', 'How', 'are', 'you?'], correctAnswer: 'Hi, I’m John. How are you?', correctAnswer_vi: 'Chào, tôi là John. Bạn khỏe không?', hint_vi: 'Đây là một lời chào, giới thiệu và hỏi thăm.', rationale_vi: 'Đây là một chuỗi câu giao tiếp cơ bản: chào, giới thiệu tên và hỏi thăm sức khỏe.', rationale_en: 'This is a basic conversational sequence: greeting, introduction, and inquiry.' },
            { type: 'rearrange', question: 'Sắp xếp các từ sau thành câu đúng:', words: ['Nice', 'to', 'meet', 'you.'], correctAnswer: 'Nice to meet you.', correctAnswer_vi: 'Rất vui được gặp bạn.', hint_vi: 'Câu chào hỏi khi gặp lần đầu.', rationale_vi: 'Đây là một cụm từ cố định dùng để chào hỏi.', rationale_en: 'This is a fixed phrase used as a greeting.' },
            { type: 'mc', question: 'May I go out? - Yes, ….', options: [ { text: 'A. you can', isCorrect: true }, { text: 'B. you can’t', isCorrect: false }, { text: 'C. you aren’t', isCorrect: false }, { text: 'D. it is', isCorrect: false } ], correctAnswer: 'A. you can', correctAnswer_vi: 'bạn có thể', hint_vi: 'Câu trả lời đồng ý cho câu hỏi "May I...?".', rationale_vi: 'Câu hỏi bắt đầu bằng "May I" được trả lời bằng "Yes, you can" (đồng ý) hoặc "No, you can\'t" (không đồng ý).', rationale_en: 'A question starting with "May I" is answered with "Yes, you can" (affirmative) or "No, you can\'t" (negative).' },
            { type: 'fill-in-the-blank', question: 'Tom is my friend, t__.', correctAnswer: 'oo', correctAnswer_vi: 'oo (để hoàn thành "too")', hint_vi: 'Từ có nghĩa là "cũng vậy". (2 ký tự)', rationale_vi: 'Từ "too" có nghĩa là "cũng vậy", được đặt ở cuối câu.', rationale_en: 'The word "too" means "also" and is placed at the end of the sentence.' },
            { type: 'mc', question: 'My name is Jane. This is … family.', options: [ { text: 'A. I', isCorrect: false }, { text: 'B. my', isCorrect: true }, { text: 'C. mine', isCorrect: false }, { text: 'D. me', isCorrect: false } ], correctAnswer: 'B. my', correctAnswer_vi: 'của tôi', hint_vi: 'Cần một tính từ sở hữu đứng trước danh từ "family".', rationale_vi: 'Tính từ sở hữu "my" được dùng trước danh từ để chỉ sự sở hữu.', rationale_en: 'The possessive adjective "my" is used before a noun to show possession.' },
            { type: 'rearrange', question: 'Sắp xếp các từ sau thành câu đúng:', words: ['I', 'have', 'two', 'books', 'in', 'my bag.'], correctAnswer: 'I have two books in my bag.', correctAnswer_vi: 'Tôi có hai quyển sách trong cặp.', hint_vi: 'Bắt đầu bằng chủ ngữ "I".', rationale_vi: 'Cấu trúc câu: "Chủ ngữ + động từ + số lượng + danh từ + cụm giới từ".', rationale_en: 'Sentence structure: "Subject + verb + quantity + noun + prepositional phrase".' },
            { type: 'rearrange', question: 'Sắp xếp các từ sau thành câu đúng:', words: ['This', 'is', 'a', 'pen.'], correctAnswer: 'This is a pen.', correctAnswer_vi: 'Đây là một cây bút.', hint_vi: 'Câu giới thiệu đồ vật ở gần.', rationale_vi: 'Cấu trúc câu giới thiệu: "This is + a/an + danh từ".', rationale_en: 'Sentence structure: "This is + a/an + noun".' },
            { type: 'multimedia', question: 'Listen and fill in the blank: gi__', mediaType: 'audio', mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2016/11/30/636161002648109672_Audio.mp3', audioContent: 'girl', correctAnswer: 'rl', correctAnswer_vi: 'rl (để hoàn thành "girl")', hint_vi: 'Từ chỉ một bạn nữ. (2 ký tự)', rationale_vi: 'Đoạn audio đọc từ "girl".', rationale_en: 'The audio says the word "girl".' },
            { type: 'mc', question: 'There are ... books on the desk.', options: [ { text: 'A. a', isCorrect: false }, { text: 'B. one', isCorrect: false }, { text: 'C. much', isCorrect: false }, { text: 'D. many', isCorrect: true } ], correctAnswer: 'D. many', correctAnswer_vi: 'nhiều', hint_vi: '"books" là danh từ đếm được số nhiều.', rationale_vi: '"many" được dùng với danh từ đếm được số nhiều. "much" dùng cho danh từ không đếm được.', rationale_en: '"many" is used with plural countable nouns. "much" is used with uncountable nouns.' }
        ];

        // --- Component: ProgressBar (from components/layout/ProgressBar.tsx) ---
        const ProgressBar = ({ percentage }) => (
            <div className="w-full h-2 bg-blue-100 rounded-full mt-4 overflow-hidden">
                <div
                    className="h-full bg-blue-500 transition-all duration-500 ease-in-out"
                    style={{ width: `${percentage}%` }}
                ></div>
            </div>
        );

        // --- Component: MessageBox (from components/layout/MessageBox.tsx) ---
        const MessageBox = ({ message, type }) => {
            const [visible, setVisible] = React.useState(false);

            React.useEffect(() => {
                if (message) {
                    setVisible(true);
                    const timer = setTimeout(() => setVisible(false), 2700);
                    return () => clearTimeout(timer);
                } else {
                    setVisible(false);
                }
            }, [message, type]);

            const baseClasses = "fixed top-4 left-1/2 -translate-x-1/2 p-4 rounded-xl shadow-xl text-center font-bold text-lg z-50 transition-all duration-300 transform";
            const typeClasses = {
                success: 'bg-green-100 border border-green-500 text-green-800',
                error: 'bg-red-100 border border-red-500 text-red-800',
                info: 'bg-yellow-100 border border-yellow-500 text-yellow-800',
            };
            const visibilityClasses = visible ? 'opacity-100 scale-100' : 'opacity-0 scale-90 pointer-events-none';

            if (!message) return null;

            return <div className={`${baseClasses} ${typeClasses[type]} ${visibilityClasses}`}>{message}</div>;
        };

        // --- Component: RationaleBox (from components/game/RationaleBox.tsx) ---
        const RationaleBox = ({ question, isCorrect, submittedAnswer }) => {
            const boxClasses = `mt-6 p-4 rounded-xl border transition duration-300 ease-in-out border-l-4 ${
                isCorrect ? 'bg-green-50 border-green-600' : 'bg-red-50 border-red-600'
            } animate-[fadeIn_0.5s_ease-in-out]`;
            
            const submittedAnswerDisplay = () => {
                const isFillIn = question.type === 'fill-in-the-blank' || (question.type === 'multimedia' && !question.options);
                if (isCorrect && !isFillIn) return null;
                
                return (
                    <React.Fragment>
                        <strong className="text-gray-700">
                            {question.type === 'mc' || (question.type === 'multimedia' && question.options) ? 'Bạn đã chọn: ' : 'Câu trả lời của bạn: '}
                        </strong>
                        <span className="text-red-700 font-medium break-words">{submittedAnswer}</span>
                        <br/>
                    </React.Fragment>
                );
            }

            return (
                <div className={boxClasses}>
                    <p className="font-bold text-lg mb-2 text-blue-700">Giải thích:</p>
                    <div className="text-gray-700 space-y-1">
                        {submittedAnswerDisplay()}
                        <div>
                            <strong>Đáp án đúng:</strong> <span className="text-green-800 font-semibold">{question.correctAnswer}</span>
                        </div>
                        
                        {question.correctAnswer_vi && (
                            <div>
                                <strong>Nghĩa là:</strong> <span className="text-green-600 font-medium">{question.correctAnswer_vi}</span>
                            </div>
                        )}
                        <p className="pt-1">{question.rationale_vi || 'Không có giải thích chi tiết.'}</p>
                    </div>
                    <div className="text-gray-600 italic mt-2 text-sm border-t border-gray-300 pt-2">
                        <strong>Rationale:</strong> {question.rationale_en || 'No detailed rationale.'}
                    </div>
                </div>
            );
        };

        // --- Component: MediaDisplay (from components/questions/MediaDisplay.tsx) ---
        const MediaDisplay = ({ question, showMessage }) => {
            if (question.mediaType === 'image') {
                return (
                    <div className="w-full p-4 bg-gray-100 rounded-xl mb-4 text-center border-2 border-dashed border-gray-300">
                        <p className="text-blue-600 font-bold mb-2">🖼️ Câu hỏi kèm Hình ảnh</p>
                        <img 
                            src={question.mediaSource}
                            alt={question.imagePrompt || 'Media for question'} 
                            className="w-full max-w-xs mx-auto rounded-lg shadow-md border-2 border-gray-300"
                            crossOrigin="anonymous"
                            referrerPolicy="no-referrer"
                            onError={(e) => { 
                                const target = e.target;
                                target.onerror = null; 
                                target.src = `https://picsum.photos/566/320`; 
                                showMessage('Lỗi tải ảnh gốc, ảnh thay thế được hiển thị.', 'error');
                            }}
                        />
                        {question.imagePrompt && <p className="text-sm text-blue-600 mt-2 font-medium">Gợi ý: {question.imagePrompt}</p>}
                    </div>
                );
            }

            if (question.mediaType === 'audio') {
                return (
                    <div className="w-full p-4 bg-gray-100 rounded-xl mb-4 text-center border-2 border-dashed border-gray-300">
                        <p className="text-blue-600 font-bold mb-2">🔊 Câu hỏi Nghe (Bấm Play)</p>
                        <audio 
                            controls
                            src={question.mediaSource}
                            className="w-full max-w-sm mx-auto my-2"
                            crossOrigin="anonymous"
                            referrerPolicy="no-referrer"
                            onError={() => {
                                showMessage('Lỗi tải Audio: File media có thể bị chặn bởi trình duyệt.', 'error');
                            }}
                        >
                            <source src={question.mediaSource} type="audio/mpeg" />
                            Trình duyệt của bạn không hỗ trợ phần tử audio.
                        </audio>
                    </div>
                );
            }
            return null;
        }

        // --- Component: FillInTheBlankQuestion (from components/questions/FillInTheBlankQuestion.tsx) ---
        const FillInTheBlankQuestion = ({ question, isAnswered, onSubmit, showMessage, questionIndex }) => {
            const [inputValue, setInputValue] = React.useState('');

            React.useEffect(() => setInputValue(''), [question]);

            const handleSubmitClick = () => {
                const trimmedInput = inputValue.trim();
                if (trimmedInput === '') {
                    showMessage('Vui lòng điền câu trả lời của bạn!', 'info');
                    return;
                }
                const isCorrect = trimmedInput.toLowerCase() === question.correctAnswer.toLowerCase();
                onSubmit(trimmedInput, isCorrect);
            };
            
            const questionTextParts = React.useMemo(() => {
                const text = question.question.replace(/^\d+\.\s*/, '');
                const blankRegex = /__+/;
                if (!blankRegex.test(text)) return [text, ''];
                const parts = text.split(blankRegex);
                return [parts[0], parts.slice(1).join('____')];
            }, [question.question]);

            const isSubmissionCorrect = isAnswered && inputValue.trim().toLowerCase() === question.correctAnswer.toLowerCase();

            const inputClasses = `inline-block mx-2 p-2 border-2 rounded-lg text-lg text-center shadow-sm transition duration-200 align-baseline font-mono ${
                isAnswered 
                ? (isSubmissionCorrect ? 'border-green-500 bg-green-50 font-bold text-green-800' : 'border-red-500 bg-red-50 font-bold text-red-800')
                : 'border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500'
            }`;

            const placeholderLength = question.correctAnswer.length > 0 ? question.correctAnswer.length : 4;
            const inputWidthStyle = { width: `${Math.max(8, placeholderLength * 1.5)}rem`, maxWidth: '100%' };

            return (
                <div className="space-y-4">
                    {question.type === 'multimedia' && <MediaDisplay question={question} showMessage={showMessage} />}
                    <div className="text-xl sm:text-2xl font-semibold mb-6 leading-relaxed text-center flex justify-center items-center flex-wrap">
                        <span className="mr-2">{questionIndex + 1}.</span>
                        {questionTextParts[0] && <span>{questionTextParts[0]}</span>}
                        <input
                            type="text"
                            value={inputValue}
                            onChange={(e) => setInputValue(e.target.value)}
                            disabled={isAnswered}
                            placeholder={isAnswered ? question.correctAnswer : "Điền từ/chữ"}
                            className={inputClasses}
                            style={inputWidthStyle}
                            onKeyPress={(e) => e.key === 'Enter' && !isAnswered && handleSubmitClick()}
                            aria-label="Fill in the blank"
                            autoFocus
                        />
                        {questionTextParts[1] && <span>{questionTextParts[1]}</span>}
                    </div>
                    <button
                        onClick={handleSubmitClick}
                        disabled={isAnswered}
                        className="w-full py-3 px-4 bg-green-600 text-white font-semibold rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed active:scale-98"
                    >Kiểm Tra</button>
                </div>
            );
        };

        // --- Component: MultipleChoiceQuestion (from components/questions/MultipleChoiceQuestion.tsx) ---
        const MultipleChoiceQuestion = ({ question, isAnswered, onSubmit, showMessage, questionIndex }) => {
            const [selectedIndex, setSelectedIndex] = React.useState(null);

            React.useEffect(() => setSelectedIndex(null), [question]);

            const handleSubmitClick = () => {
                if (selectedIndex === null) {
                    showMessage('Vui lòng chọn một đáp án!', 'info');
                    return;
                }
                const selectedOption = question.options[selectedIndex];
                onSubmit(selectedOption.text, selectedOption.isCorrect);
            };
            
            const cleanQuestionText = question.question.replace(/^\d+\.\s*/, '');

            return (
                <React.Fragment>
                    {question.type === 'multimedia' && <MediaDisplay question={question} showMessage={showMessage} />}
                    <h3
                        className="text-xl sm:text-2xl font-semibold mb-6 leading-relaxed"
                        dangerouslySetInnerHTML={{ __html: `${questionIndex + 1}. ${cleanQuestionText}` }}
                    />
                    <div className="space-y-4">
                        <div className="space-y-3">
                            {question.options?.map((option, index) => {
                                const isSelected = selectedIndex === index;
                                let labelClasses = "block p-4 border-2 rounded-xl shadow-md text-lg transition duration-200";

                                if (isAnswered) {
                                    labelClasses += " cursor-default";
                                    if (option.isCorrect) labelClasses += " bg-green-100 border-green-500 font-bold text-green-900";
                                    else if (isSelected) labelClasses += " bg-red-100 border-red-500 font-bold text-red-900";
                                    else labelClasses += " border-gray-200 opacity-60";
                                } else {
                                    labelClasses += " cursor-pointer hover:bg-blue-50 hover:border-blue-300";
                                    if(isSelected) labelClasses += " bg-blue-100 border-blue-500 ring-2 ring-blue-400";
                                    else labelClasses += " border-gray-200";
                                }

                                return (
                                    <div key={index} className="relative">
                                        <input
                                            type="radio" id={`option-${questionIndex}-${index}`} name={`mc-option-${questionIndex}`}
                                            value={index} className="hidden" checked={isSelected}
                                            onChange={() => setSelectedIndex(index)} disabled={isAnswered}
                                        />
                                        <label htmlFor={`option-${questionIndex}-${index}`} className={labelClasses}>
                                            {option.text}
                                        </label>
                                    </div>
                                );
                            })}
                        </div>
                        <button
                            onClick={handleSubmitClick}
                            disabled={isAnswered}
                            className="w-full py-3 px-4 bg-green-600 text-white font-semibold rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed active:scale-98"
                        >Kiểm Tra</button>
                    </div>
                </React.Fragment>
            );
        };

        // --- Component: RearrangeQuestion (from components/questions/RearrangeQuestion.tsx) ---
        const WordBlock = ({ word, onClick, isSource, isAnswered }) => {
            const baseClasses = 'inline-flex items-center justify-center px-3 py-2 text-base sm:text-lg font-semibold rounded-lg shadow-sm transition-all duration-150 break-words transform active:scale-95';
            const sourceClasses = isSource ? 'bg-blue-100 text-blue-800 hover:bg-blue-200' : 'bg-gray-100 text-gray-800 border-b-2 border-gray-300';
            const disabledClasses = 'opacity-60 cursor-default shadow-inner';
            const interactiveClasses = 'cursor-pointer';

            return (
                <span 
                    onClick={!isAnswered ? onClick : undefined} 
                    className={`${baseClasses} ${sourceClasses} ${isAnswered ? disabledClasses : interactiveClasses}`}
                >
                    {word.text}
                </span>
            );
        };

        const RearrangeQuestion = ({ question, isAnswered, onSubmit, showMessage, questionIndex, isCorrect }) => {
            const [sentenceWords, setSentenceWords] = React.useState([]);
            const initialSourceWords = React.useMemo(() => 
                [...(question.words ?? [])]
                    .map((text) => ({ id: crypto.randomUUID(), text }))
                    .sort(() => Math.random() - 0.5), 
                [question]
            );
            const [sourceWords, setSourceWords] = React.useState(initialSourceWords);

            React.useEffect(() => {
                setSourceWords(initialSourceWords);
                setSentenceWords([]);
            }, [initialSourceWords]);

            const handleSelectWord = (word) => {
                setSourceWords(prev => prev.filter(w => w.id !== word.id));
                setSentenceWords(prev => [...prev, word]);
            };

            const handleReturnWord = (word) => {
                setSentenceWords(prev => prev.filter(w => w.id !== word.id));
                setSourceWords(prev => [...prev, word].sort((a, b) => {
                    const indexA = initialSourceWords.findIndex(sw => sw.id === a.id);
                    const indexB = initialSourceWords.findIndex(sw => sw.id === b.id);
                    return indexA - indexB;
                }));
            };

            const handleSubmitClick = () => {
                if (sentenceWords.length === 0) {
                    showMessage('Vui lòng sắp xếp các từ!', 'info');
                    return;
                }
                const submitted = sentenceWords.map(w => w.text).join(' ').replace(/\s+([.,?!])/g, '$1').trim();
                const normalize = (str) => str.replace(/[.,?!’']/g, '').replace(/\s+/g, ' ').toLowerCase().trim();
                const isCorrectResult = normalize(submitted) === normalize(question.correctAnswer);
                onSubmit(submitted, isCorrectResult);
            };
            
            const cleanQuestionText = question.question.replace(/^\d+\.\s*/, '');

            return (
                <React.Fragment>
                    <h3 className="text-xl sm:text-2xl font-semibold mb-6 leading-relaxed" dangerouslySetInnerHTML={{ __html: `${questionIndex + 1}. ${cleanQuestionText}` }} />
                    <div className="space-y-4">
                        <div className={`min-h-[60px] p-3 border-2 rounded-xl shadow-inner flex flex-wrap gap-2 items-center transition duration-300 ${isAnswered ? (isCorrect ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50') : 'border-blue-300 bg-blue-50 border-dashed'}`}>
                            {sentenceWords.length === 0 && !isAnswered ? (
                                <span className="text-gray-500 italic text-sm">Chạm vào các từ bên dưới để xây dựng câu...</span>
                            ) : (
                                sentenceWords.map(word => <WordBlock key={word.id} word={word} onClick={() => handleReturnWord(word)} isSource={false} isAnswered={isAnswered} />)
                            )}
                        </div>
                        <div className="min-h-[100px] p-4 bg-gray-100 rounded-xl shadow-md flex flex-wrap gap-2 items-center border border-gray-200">
                            {sourceWords.map(word => <WordBlock key={word.id} word={word} onClick={() => handleSelectWord(word)} isSource={true} isAnswered={isAnswered} />)}
                        </div>
                        <button onClick={handleSubmitClick} disabled={isAnswered} className="w-full py-3 px-4 bg-green-600 text-white font-semibold rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed active:scale-98">Kiểm Tra</button>
                    </div>
                </React.Fragment>
            );
        };

        // --- Component: StartScreen (from components/screens/StartScreen.tsx) ---
        const StartScreen = ({ onStart }) => {
            const [name, setName] = React.useState('');
            const handleStart = () => name.trim() && onStart(name.trim());
            const isButtonDisabled = name.trim() === '';

            return (
                <div className="animate-[fadeIn_0.5s_ease-in-out] text-center p-4">
                    <header className="mb-8">
                        <h1 className="text-3xl sm:text-4xl font-extrabold text-blue-600 mb-2">Bài Thi Thử IOE Lớp 3</h1>
                        <p className="text-lg text-gray-500">Đề số 01: Kiến thức cơ bản ({QUESTIONS.length} câu)</p>
                    </header>
                    <div className="max-w-md mx-auto bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                        <h2 className="text-2xl font-semibold mb-4 text-gray-700">Chào mừng bạn!</h2>
                        <p className="text-gray-600 mb-6">Mỗi câu trả lời đúng được cộng 10 điểm. Cố gắng hết mình nhé!</p>
                        <div className="space-y-4">
                            <label htmlFor="player-name" className="block text-sm font-medium text-gray-700 text-left">Nhập tên của bạn để bắt đầu:</label>
                            <input
                                type="text" id="player-name" placeholder="Tên người chơi"
                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-lg shadow-sm transition duration-150"
                                maxLength={50} value={name} onChange={(e) => setName(e.target.value)}
                                onKeyPress={(e) => e.key === 'Enter' && !isButtonDisabled && handleStart()}
                                autoFocus
                            />
                            <button
                                onClick={handleStart} disabled={isButtonDisabled}
                                className="w-full py-3 px-4 bg-blue-500 text-white font-bold rounded-xl shadow-lg transition duration-300 hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-xl active:scale-98"
                            >Bắt Đầu</button>
                        </div>
                    </div>
                </div>
            );
        };
        
        // --- Component: EndScreen (from components/screens/EndScreen.tsx) ---
        const EndScreen = ({ playerName, score, onRestart, mistakes }) => {
            const [showReview, setShowReview] = React.useState(false);
            const maxScore = QUESTIONS.length * 10;
            const percentage = maxScore > 0 ? (score / maxScore) * 100 : 0;
            const message = percentage >= 80 ? "Xuất sắc! Bạn làm rất tốt!" : percentage >= 50 ? "Khá tốt! Cố gắng hơn nữa nhé." : "Cần cố gắng thêm. Đừng nản lòng!";

            return (
                <div className="text-center animate-[fadeIn_0.5s_ease-in-out] p-4">
                    <h2 className="text-3xl font-bold mb-4 text-green-600">🎉 Hoàn Thành Bài Thi! 🎉</h2>
                    <p className="text-xl text-gray-700 mb-2">Chúc mừng, <span className="font-extrabold text-blue-600">{playerName}</span>!</p>
                    <p className="text-lg text-gray-600 mb-6">{message}</p>
                    <div className="bg-white p-8 rounded-xl shadow-lg inline-block border border-gray-100">
                        <p className="text-2xl font-semibold mb-8 text-gray-700">Điểm số cuối cùng của bạn:</p>
                        <p className={`text-6xl font-black mb-10 text-blue-600`}>{score} / {maxScore}</p>
                    </div>
                    <div className="mt-8 flex justify-center flex-wrap gap-4">
                        <button
                            onClick={onRestart}
                            className="py-3 px-6 bg-blue-500 text-white font-bold rounded-xl shadow-lg transition duration-300 hover:bg-blue-600 text-lg active:scale-98"
                        >Làm lại</button>
                        {mistakes.length > 0 && (
                            <button
                                onClick={() => setShowReview(!showReview)}
                                className="py-3 px-6 bg-yellow-500 text-white font-bold rounded-xl shadow-lg transition duration-300 hover:bg-yellow-600 text-lg active:scale-98"
                            >{showReview ? 'Ẩn câu sai' : `Xem lại ${mistakes.length} câu sai`}</button>
                        )}
                    </div>

                    {showReview && (
                        <div className="mt-8 text-left border-t pt-6 animate-[fadeIn_0.5s_ease-in-out]">
                            <h3 className="text-2xl font-bold text-red-600 mb-4 text-center">Xem lại các câu sai</h3>
                            <div className="space-y-6">
                                {mistakes.map((mistake, index) => (
                                    <div key={index} className="p-4 bg-red-50 rounded-lg border-l-4 border-red-500">
                                        <p className="font-semibold text-gray-800 mb-2" dangerouslySetInnerHTML={{ __html: `${index + 1}. ${mistake.question.question}`}} />
                                        <p><strong>Câu trả lời của bạn:</strong> <span className="text-red-700 font-medium">{mistake.submittedAnswer}</span></p>
                                        <p><strong>Đáp án đúng:</strong> <span className="text-green-700 font-medium">{mistake.question.correctAnswer}</span></p>
                                        <p className="mt-2 text-sm text-gray-600"><em>{mistake.question.rationale_vi}</em></p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- Component: QuizScreen (from components/screens/QuizScreen.tsx) ---
        const QuizScreen = ({ playerName, onEnd }) => {
            const [shuffledQuestions, setShuffledQuestions] = React.useState([]);
            const [currentQuestionIndex, setCurrentQuestionIndex] = React.useState(0);
            const [score, setScore] = React.useState(0);
            const [isAnswered, setIsAnswered] = React.useState(false);
            const [isCorrect, setIsCorrect] = React.useState(false);
            const [submittedAnswer, setSubmittedAnswer] = React.useState('');
            const [isHintVisible, setIsHintVisible] = React.useState(false);
            const [message, setMessage] = React.useState(null);
            const [mistakes, setMistakes] = React.useState([]);

            React.useEffect(() => {
                const array = [...QUESTIONS];
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                setShuffledQuestions(array);
            }, []);

            const currentQuestion = shuffledQuestions[currentQuestionIndex];

            React.useEffect(() => {
                setIsAnswered(false);
                setIsCorrect(false);
                setSubmittedAnswer('');
                setIsHintVisible(false);
                setMessage(null);
            }, [currentQuestionIndex]);
            
            const showMessage = (text, type) => setMessage({ text, type });

            const handleSubmit = React.useCallback((answer, isAnswerCorrect) => {
                if (isAnswered) return;
                
                setIsAnswered(true);
                setSubmittedAnswer(answer);
                setIsCorrect(isAnswerCorrect);

                if (isAnswerCorrect) {
                    setScore(prev => prev + 10);
                    showMessage('CHÍNH XÁC! +10 điểm', 'success');
                } else {
                    showMessage('SAI RỒI! Cùng xem lại nhé.', 'error');
                    setMistakes(prev => [...prev, { question: currentQuestion, submittedAnswer: answer }]);
                }
            }, [isAnswered, currentQuestion]);

            const handleNext = () => {
                if (currentQuestionIndex < shuffledQuestions.length - 1) {
                    setCurrentQuestionIndex(prev => prev + 1);
                } else {
                    onEnd(score, mistakes);
                }
            };

            if (!currentQuestion) {
                return <div className="text-center p-8">Đang tải câu hỏi...</div>;
            }

            const progressPercentage = ((currentQuestionIndex + 1) / shuffledQuestions.length) * 100;
            
            const renderQuestionComponent = () => {
                const commonProps = { isAnswered, onSubmit: handleSubmit, showMessage, questionIndex: currentQuestionIndex, isCorrect };
                
                switch(currentQuestion.type) {
                    case 'rearrange':
                        return <RearrangeQuestion {...commonProps} question={currentQuestion} />;
                    case 'mc':
                        return <MultipleChoiceQuestion {...commonProps} question={currentQuestion} />;
                    case 'fill-in-the-blank':
                        return <FillInTheBlankQuestion {...commonProps} question={currentQuestion} />;
                    case 'multimedia':
                        if (currentQuestion.options) {
                            return <MultipleChoiceQuestion {...commonProps} question={currentQuestion} />;
                        }
                        return <FillInTheBlankQuestion {...commonProps} question={currentQuestion} />;
                    default:
                        return <div className="text-red-500">Lỗi: Loại câu hỏi không xác định.</div>;
                }
            };

            return (
                <div className="animate-[fadeIn_0.5s_ease-in-out]">
                    {message && <MessageBox message={message.text} type={message.type} />}
                    <header className="text-center mb-8">
                        <h1 className="text-3xl sm:text-4xl font-extrabold text-blue-600 mb-2">Bài Thi Thử IOE Lớp 3</h1>
                        <ProgressBar percentage={progressPercentage} />
                    </header>

                    <div className="flex justify-between items-center mb-6 py-2 px-4 bg-blue-50 rounded-xl shadow-inner border border-blue-100">
                        <p className="text-sm sm:text-base font-medium text-blue-800">Người chơi: <span className="font-bold">{playerName}</span></p>
                        <p className="text-sm sm:text-base font-medium text-blue-800">Điểm: <span className="text-xl font-extrabold text-red-600">{score}</span></p>
                        <p className="text-sm sm:text-base font-medium text-blue-800">Câu: <span className="font-bold">{currentQuestionIndex + 1}/{shuffledQuestions.length}</span></p>
                    </div>

                    <div className="mb-8">{renderQuestionComponent()}</div>

                    <div className="mt-8 border-t pt-6 flex justify-between items-center flex-wrap gap-4">
                        <div className="relative">
                            <button
                                className="bg-yellow-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 hover:bg-yellow-600 active:scale-95"
                                onMouseEnter={() => setIsHintVisible(true)} onMouseLeave={() => setIsHintVisible(false)}
                                onClick={() => setIsHintVisible(v => !v)}
                            >💡 Gợi ý</button>
                            <div className={`absolute bottom-full mb-2 w-max max-w-[90vw] sm:max-w-sm p-4 bg-yellow-100 border-l-4 border-yellow-500 rounded-xl shadow-lg transition-all duration-300 transform origin-bottom-left z-10 ${isHintVisible ? 'opacity-100 scale-100' : 'opacity-0 scale-90 pointer-events-none'}`}>
                                <p className="font-semibold text-yellow-800">Gợi ý:</p>
                                <p className="text-yellow-700">{currentQuestion.hint_vi || 'Không có gợi ý.'}</p>
                            </div>
                        </div>
                        <button onClick={handleNext} disabled={!isAnswered} className="flex-grow py-3 px-4 bg-blue-500 text-white font-bold rounded-xl shadow-xl transition duration-300 hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed active:scale-98 text-lg">
                            {currentQuestionIndex === shuffledQuestions.length - 1 ? 'Hoàn Thành' : 'Câu Tiếp Theo »'}
                        </button>
                    </div>

                    {isAnswered && <RationaleBox question={currentQuestion} isCorrect={isCorrect} submittedAnswer={submittedAnswer} />}
                </div>
            );
        };
        
        // --- Component: App (from App.tsx) ---
        const App = () => {
            const [gameState, setGameState] = React.useState('start'); // 'start', 'quiz', 'end'
            const [playerName, setPlayerName] = React.useState('');
            const [score, setScore] = React.useState(0);
            const [mistakes, setMistakes] = React.useState([]);

            const handleStartQuiz = React.useCallback((name) => {
                setPlayerName(name);
                setScore(0);
                setMistakes([]);
                setGameState('quiz');
            }, []);

            const handleEndQuiz = React.useCallback((finalScore, finalMistakes) => {
                setScore(finalScore);
                setMistakes(finalMistakes);
                setGameState('end');
            }, []);
            
            const handleRestartQuiz = React.useCallback(() => {
                setGameState('start');
            }, []);

            const renderContent = () => {
                switch (gameState) {
                    case 'quiz': 
                        return <QuizScreen playerName={playerName} onEnd={handleEndQuiz} />;
                    case 'end': 
                        return <EndScreen playerName={playerName} score={score} onRestart={handleRestartQuiz} mistakes={mistakes} />;
                    default: 
                        return <StartScreen onStart={handleStartQuiz} />;
                }
            };

            return (
                <div className="p-4 sm:p-8 flex justify-center items-start min-h-screen">
                    <div className="w-full max-w-3xl bg-white rounded-xl shadow-2xl p-6 sm:p-8 md:p-10 border border-gray-100 min-h-[80vh]">
                        {renderContent()}
                    </div>
                </div>
            );
        };
        
        // --- Entry point (from index.tsx) ---
        const rootElement = document.getElementById('root');
        const root = ReactDOM.createRoot(rootElement);
        root.render(
            <React.StrictMode>
                <App />
            </React.StrictMode>
        );

    </script>
</body>
</html>
